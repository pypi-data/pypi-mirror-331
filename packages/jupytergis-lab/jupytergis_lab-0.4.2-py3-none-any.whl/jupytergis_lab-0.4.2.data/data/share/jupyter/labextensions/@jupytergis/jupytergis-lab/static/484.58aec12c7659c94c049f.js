"use strict";(self.webpackChunk_jupytergis_jupytergis_lab=self.webpackChunk_jupytergis_jupytergis_lab||[]).push([[484],{484:(e,t,a)=>{a.r(t),a.d(t,{default:()=>v});var o=a(717),n=a(79),r=a(738),s=a(621),d=a(198),i=a(162),m=a(625),l=a(256),c=a(903),u=a(209),g=a(259),p=a(310),y=a(123),I=a(230),h=a(173);class M extends h.JupyterYModel{}class j extends l.Panel{constructor(e){super(),this._buildWidget=e=>{const{commands:t,model:a,externalCommands:n,tracker:r}=e,s=new o.JupyterGISPanel({model:a,commandRegistry:t});let d;a.filePath&&(d=new o.ToolbarWidget({commands:t,model:a,externalCommands:(null==n?void 0:n.getCommands())||[]})),this._jgisWidget=new o.JupyterGISOutputWidget({model:a,content:s,toolbar:d}),this.addWidget(this._jgisWidget),null==r||r.add(this._jgisWidget)};const{model:t}=e;this.addClass("jupytergis-notebook-widget"),this._buildWidget(e),t.sharedModel.changed.connect(((t,a)=>{a.stateChange&&a.stateChange.forEach((t=>{var a;"path"===t.name&&(null===(a=this.layout)||void 0===a||a.removeWidget(this._jgisWidget),this._jgisWidget.dispose(),this._buildWidget(e))}))}))}get jgisWidget(){return this._jgisWidget}}const b={id:"jupytergis:yjswidget-plugin",autoStart:!0,optional:[n.IJGISExternalCommandRegistryToken,n.IJupyterGISDocTracker,h.IJupyterYWidgetManager,c.ICollaborativeDrive],activate:(e,t,a,o,r)=>{o?o.registerWidget("@jupytergis:widget",class extends M{async initialize(t){const{path:a,format:o,contentType:s}=t,d=o;if(!r)throw(0,u.showErrorMessage)("Error using the JupyterGIS Python API","You cannot use the JupyterGIS Python API without a collaborative drive. You need to install a package providing collaboration features (e.g. jupyter-collaboration)."),new Error("Failed to create the YDoc without a collaborative drive");let i="";const m=e.shell.currentWidget;(m instanceof y.NotebookPanel||m instanceof g.ConsolePanel)&&(i=m.sessionContext.path);let l="";if(a){l=p.PathExt.join(p.PathExt.dirname(i),a);try{await e.serviceManager.contents.get(l)}catch(t){await e.serviceManager.contents.save(l,{content:btoa("{}"),format:"base64"})}}else l=p.PathExt.join(p.PathExt.dirname(i),"unsaved_project");const c=r.sharedModelFactory.createNew({path:l,format:d,contentType:s,collaborative:!0});this.jupyterGISModel=new n.JupyterGISModel({sharedModel:c}),this.jupyterGISModel.contentsManager=e.serviceManager.contents,this.jupyterGISModel.filePath=l,this.ydoc=this.jupyterGISModel.sharedModel.ydoc,this.sharedModel=new h.JupyterYDoc(t,this.ydoc)}},class{constructor(o,n){this.yModel=o,this.node=n;const r=new j({commands:e.commands,model:o.jupyterGISModel,externalCommands:t,tracker:a});this._jgisWidget=r.jgisWidget,I.MessageLoop.sendMessage(r,l.Widget.Msg.BeforeAttach),n.appendChild(r.node),I.MessageLoop.sendMessage(r,l.Widget.Msg.AfterAttach)}dispose(){this._jgisWidget.dispose()}}):console.error("Missing IJupyterYWidgetManager token!")}},C="jupytergis",v=[{id:"jupytergis:lab:main-menu",autoStart:!0,requires:[n.IJupyterGISDocTracker,n.IJGISFormSchemaRegistryToken,n.IJGISLayerBrowserRegistryToken,i.IStateDB],optional:[d.IMainMenu,m.ITranslator,s.ICompletionProviderManager],activate:(e,t,a,n,r,s,d,i)=>{console.log("jupytergis:lab:main-menu is activated!"),d=null!=d?d:m.nullTranslator;(0,o.createDefaultLayerRegistry)(n),o.GlobalStateDbManager.getInstance().initialize(r),(0,o.addCommands)(e,t,d,a,n,r,i),e.shell.addClass("data-jgis-keybinding");const c=new l.Menu({commands:e.commands});c.title.label=d.load("jupyterlab").__("Add Source"),c.id="jp-gis-contextmenu-addSource",e.contextMenu.addItem({type:"submenu",selector:".jp-gis-sourcePanel",rank:3,submenu:c}),c.addItem({command:o.CommandIDs.newRasterSource,args:{from:"contextMenu"}}),c.addItem({command:o.CommandIDs.newVectorSource,args:{from:"contextMenu"}}),c.addItem({command:o.CommandIDs.newGeoJSONSource,args:{from:"contextMenu"}}),c.addItem({command:o.CommandIDs.newRasterDemSource,args:{from:"contextMenu"}}),c.addItem({command:o.CommandIDs.newImageSource,args:{from:"contextMenu"}}),e.contextMenu.addItem({type:"separator",selector:".jp-gis-sourcePanel",rank:2}),e.contextMenu.addItem({selector:".jp-gis-source.jp-gis-sourceUnused",rank:1,command:o.CommandIDs.removeSource}),e.contextMenu.addItem({selector:".jp-gis-source",rank:1,command:o.CommandIDs.renameSource}),e.contextMenu.addItem({command:o.CommandIDs.symbology,selector:".jp-gis-layerItem",rank:1}),e.contextMenu.addItem({type:"separator",selector:".jp-gis-layerPanel",rank:1}),e.contextMenu.addItem({command:o.CommandIDs.removeLayer,selector:".jp-gis-layerItem",rank:2}),e.contextMenu.addItem({command:o.CommandIDs.renameLayer,selector:".jp-gis-layerItem",rank:2}),e.contextMenu.addItem({command:o.CommandIDs.zoomToLayer,selector:".jp-gis-layerItem",rank:2});const u=new l.Menu({commands:e.commands});u.title.label=d.load("jupyterlab").__("Move Selected Layers to Group"),u.id="jp-gis-contextmenu-movelayer",e.contextMenu.addItem({type:"submenu",selector:".jp-gis-layerItem",rank:2,submenu:u}),e.contextMenu.opened.connect((()=>function(e,t){var a,n,r,s;if(!(null===(a=t.currentWidget)||void 0===a?void 0:a.model))return;const d=null===(n=t.currentWidget)||void 0===n?void 0:n.model,i=null!==(s=null===(r=e.menu.items.find((e=>{var t;return"submenu"===e.type&&"jp-gis-contextmenu-movelayer"===(null===(t=e.submenu)||void 0===t?void 0:t.id)})))||void 0===r?void 0:r.submenu)&&void 0!==s?s:null;if(!i)return;i.clearItems();const m=function e(t){const a=[];for(const o of t)if("string"!=typeof o&&o.layers){a.push(o.name);const t=e(o.layers);a.push(...t)}return a}(d.getLayerTree());i.addItem({command:o.CommandIDs.moveLayersToGroup,args:{label:""}}),m.forEach((e=>{i.addItem({command:o.CommandIDs.moveLayersToGroup,args:{label:e}})})),i.addItem({command:o.CommandIDs.moveLayerToNewGroup})}(e.contextMenu,t))),e.contextMenu.addItem({command:o.CommandIDs.removeGroup,selector:".jp-gis-layerGroupHeader",rank:2}),e.contextMenu.addItem({command:o.CommandIDs.renameGroup,selector:".jp-gis-layerGroupHeader",rank:2}),e.contextMenu.addItem({type:"separator",selector:".jp-gis-layerPanel",rank:2});const g=new l.Menu({commands:e.commands});g.title.label=d.load("jupyterlab").__("Add Layer"),g.id="jp-gis-contextmenu-addLayer",e.contextMenu.addItem({type:"submenu",selector:".jp-gis-layerPanel",rank:3,submenu:g}),g.addItem({command:o.CommandIDs.newRasterLayer,args:{from:"contextMenu"}}),g.addItem({command:o.CommandIDs.newVectorLayer,args:{from:"contextMenu"}}),g.addItem({command:o.CommandIDs.newHillshadeLayer,args:{from:"contextMenu"}}),g.addItem({command:o.CommandIDs.newImageLayer,args:{from:"contextMenu"}}),g.addItem({command:o.CommandIDs.newHeatmapLayer,args:{from:"contextMenu"}}),s&&function(e,t){e.editMenu.undoers.redo.add({id:o.CommandIDs.redo,isEnabled:t}),e.editMenu.undoers.undo.add({id:o.CommandIDs.undo,isEnabled:t})}(s,(()=>null!==t.currentWidget&&t.currentWidget===e.shell.currentWidget))}},{id:"jupytergis:lab:controlpanel",autoStart:!0,requires:[r.ILayoutRestorer,n.IJupyterGISDocTracker,n.IJGISFormSchemaRegistryToken,i.IStateDB,n.IAnnotationToken],activate:(e,t,a,n,r,s)=>{const d=new o.ControlPanelModel({tracker:a}),i=new o.LeftPanelWidget({model:d,tracker:a,state:r,commands:e.commands});i.id="jupytergis::leftControlPanel",i.title.caption="JupyterGIS Control Panel",i.title.icon=o.logoMiniIcon;const m=new o.RightPanelWidget({model:d,tracker:a,formSchemaRegistry:n,annotationModel:s});m.id="jupytergis::rightControlPanel",m.title.caption="JupyterGIS Control Panel",m.title.icon=o.logoMiniIcon,t&&(t.add(i,C),t.add(m,C)),e.shell.add(i,"left",{rank:2e3}),e.shell.add(m,"right",{rank:2e3})}},b]}}]);