<odoo>
        <template id="selfconsumption_invoice_template" inherit_id="account.report_invoice_document">
            <xpath expr="//th[@name='th_quantity']" position="replace">
                <th name="th_quantity" t-if="o.selfconsumption_invoicing_mode == 'none'" class="text-end"><span>Quantity</span></th>
                <t t-if="o.selfconsumption_invoicing_mode == 'power_acquired'">
                    <th name="th_power_acquired" class="text-end"><span>Power acquired</span></th>
                    <th name="th_invoiced_days" class="text-end"><span>Invoiced days</span></th>
                    <th name="th_quantity" class="text-end"><span>Quantity</span></th>
                </t>
                <t t-if="o.selfconsumption_invoicing_mode == 'energy_delivered'">
                    <th name="th_total_installation_generation" class="text-end"><span>Total installation generation</span></th>
                    <th name="th_partition_coefficient" class="text-end"><span>Partition coefficient</span></th>
                    <th name="th_total_amount_invoiced" class="text-end"><span>Total amount invoiced</span></th>
                </t>
            </xpath>
            <xpath expr="//th[@name='th_priceunit']" position="after">
                <t t-if="o.selfconsumption_invoicing_mode == 'power_acquired'">
                    <th name="th_import" class="text-end"><span>Import</span></th>
                </t>
                <t t-if="o.selfconsumption_invoicing_mode == 'energy_delivered'">
                    <th name="th_import" class="text-end"><span>Import</span></th>
                </t>
            </xpath>
            <xpath expr="//th[@name='th_taxes']" position="replace">
                <th name="th_taxes" t-if="o.selfconsumption_invoicing_mode == 'none'" t-attf-class="text-start {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}"><span>Taxes</span></th>
            </xpath> 
            <xpath expr="//th[@name='th_subtotal']" position="replace">
                <th name="th_subtotal" t-if="o.selfconsumption_invoicing_mode == 'none'" class="text-end">
                    <span groups="account.group_show_line_subtotals_tax_excluded">Amount</span>
                    <span groups="account.group_show_line_subtotals_tax_included">Total Price</span>
                </th>
            </xpath>
            <xpath expr="//td[@name='account_invoice_line_name']" position="after">
                <t t-if="o.selfconsumption_invoicing_mode == 'power_acquired'">
                    <td name="td_power_acquired" class="text-end">
                        <t t-set="found" t-value="False" />
                        <t t-foreach="line.selfconsumption_id.distribution_table_ids.supply_point_assignation_ids" t-as="assignation">
                            <t t-if="line.partner_id == assignation.owner_id and line.ref == assignation.code">
                                <t t-set="power_acquired" t-value="'{:.2f}'.format(line.selfconsumption_id.power * assignation.coefficient)"/>
                                <t t-esc="power_acquired" /><span> kWn/day</span>
                                <t t-set="found" t-value="True" />
                            </t>
                        </t>
                        <t t-if="not found">
                            0 kW/day
                        </t>
                    </td>
                    <td name="td_invoiced_days" class="text-end">
                        <t t-foreach="o.invoice_line_ids" t-as="line">
                            <t t-foreach="line.contract_line_id" t-as="contract_line">
                                <t t-if="contract_line.contract_id.partner_id == line.partner_id">
                                    <span t-field="contract_line.days_invoiced"/>
                                </t>
                                <t t-else="">
                                    0
                                </t>
                            </t>
                        </t>
                    </td>
                </t>
                <t t-if="o.selfconsumption_invoicing_mode == 'energy_delivered'">
                    <td name="td_total_installation_generation" class="text-end">
                        <span t-field="line.selfconsumption_id.power"/><span> kWh</span>
                    </td>
                    <td name="td_partition_coefficient" class="text-end">
                        <t t-if="line.contract_line_id.contract_id.supply_point_assignation_id.coefficient">
                            <span t-field="line.contract_line_id.contract_id.supply_point_assignation_id.coefficient"/>
                        </t>
                    </td>
                </t>
            </xpath>
            <xpath expr="//td[@name='td_taxes']" position="replace">
                <td name="td_taxes" t-if="o.selfconsumption_invoicing_mode == 'none'" t-attf-class="text-start {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }} {{ 'text-nowrap' if len(taxes) &lt; 10 else '' }}">
                    <span t-out="taxes" id="line_tax_ids">Tax 15%</span>
                </td>
            </xpath>
        </template>
</odoo>
