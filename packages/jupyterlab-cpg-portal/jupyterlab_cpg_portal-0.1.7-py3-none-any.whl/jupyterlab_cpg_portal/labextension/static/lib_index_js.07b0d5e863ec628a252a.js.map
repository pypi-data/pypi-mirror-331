{"version":3,"file":"lib_index_js.07b0d5e863ec628a252a.js","mappings":";;;;;;;;;;;;;;;;;AAAsD;AACc;AACpE;AACA;AACA;AACO,mCAAmC,mDAAM;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,wDAAW;AACtC;AACA;AACA,oCAAoC,mDAAM;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,kEAAW;AAC1C;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B,iEAAU;AACtC;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,gCAAgC,mDAAM;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAsC,mDAAM;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sDAAsD,eAAe;AACrE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qDAAqD,cAAc;AACnE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,mDAAM;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,mDAAM;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,mDAAM;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B,mDAAM;AAClC;AACA;AACA,+BAA+B,mDAAM;AACrC;AACA;AACA;AACA,4BAA4B,mDAAM;AAClC;AACA;AACA;AACA,8BAA8B,mDAAM;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,mDAAM;AAC9B;AACA;AACA;AACA;AACA,+BAA+B,mDAAM;AACrC;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,mDAAM;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,mDAAM;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,mDAAM;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD;AACvD;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,wBAAwB;AACrE;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,UAAU;AAC9D;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;AC/UA;AACA;AAC2C;AACI;AACW;AACF;AACjD;AACP;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,qDAAM;AACtC,+BAA+B,kEAAgB;AAC/C;AACA,8BAA8B,oEAAe;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,qDAAM;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,yDAAM;AAC1B;AACA;AACA;AACA;AACA,yCAAyC,iBAAiB;AAC1D;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,qDAAqD,oBAAoB;AACzE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,yDAAM;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;ACzO0D;AACY;AACZ;AACN;AACW;AACU;AACX;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,UAAU;AAC/B,sBAAsB,UAAU;AAChC;AACA;AACA;AACO,uBAAuB,8DAAO;AACrC,aAAa,UAAU;AACvB;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA,eAAe,iEAAe;AAC9B,eAAe,oEAAe,EAAE,yEAAgB;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,gEAAU;AACd;AACA;AACA,kBAAkB,wDAAM,YAAY,kBAAkB;AACtD,KAAK;AACL;AACA;AACA;AACA,8BAA8B,qDAAc;AAC5C;AACA;AACA;AACA;AACA;AACA,2CAA2C,kEAA2B;AACtE;AACA;AACA;AACA;AACA;AACA,6BAA6B,uEAAoB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD,WAAW;AAC3D;AACA;AACA;AACA;AACA,KAAK;AACL,yBAAyB,6CAA6C;AACtE,wBAAwB,+DAAa;AACrC;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,iEAAe,iBAAiB,EAAC","sources":["webpack://jupyterlab_cpg_portal/./lib/CPGPortalFilesWidget.js","webpack://jupyterlab_cpg_portal/./lib/contents.js","webpack://jupyterlab_cpg_portal/./lib/index.js"],"sourcesContent":["import { Widget, PanelLayout } from '@lumino/widgets';\nimport { refreshIcon, launchIcon } from '@jupyterlab/ui-components';\n/**\n * Widget for browsing files using a Contents.IDrive implementation.\n */\nexport class CPGPortalFilesWidget extends Widget {\n    /**\n     * Construct a new widget.\n     *\n     * @param app - JupyterFrontEnd application.\n     * @param drive - A drive that implements Contents.IDrive.\n     */\n    constructor(app, drive) {\n        super();\n        this._app = app;\n        this._drive = drive;\n        this.id = 'cpg-portal-files-panel';\n        this.title.closable = true;\n        this.addClass('cpgPortalFilesWidget');\n        // Use a PanelLayout to stack the header and file list.\n        const layout = new PanelLayout();\n        this.layout = layout;\n        // Create a flex container to replace the deprecated toolbar.\n        const headerContainer = new Widget();\n        headerContainer.node.style.width = '100%';\n        headerContainer.node.style.display = 'flex';\n        headerContainer.node.style.justifyContent = 'space-between';\n        headerContainer.node.style.alignItems = 'center';\n        headerContainer.node.style.padding = '0px 4px';\n        // Create a title element.\n        const titleElement = document.createElement('div');\n        titleElement.textContent = 'CPG Portal Files';\n        titleElement.classList.add('cpg-portal-title');\n        headerContainer.node.appendChild(titleElement);\n        // Create a container for the buttons (aligned to the right).\n        const buttonContainer = document.createElement('div');\n        buttonContainer.style.display = 'flex';\n        // Create the refresh button using jp-button.\n        const refreshBtn = document.createElement('jp-button');\n        refreshBtn.setAttribute('appearance', 'stealth');\n        refreshBtn.setAttribute('scale', 'medium');\n        refreshBtn.setAttribute('title', 'Refresh File List');\n        refreshBtn.innerHTML = refreshIcon.svgstr;\n        refreshBtn.addEventListener('click', async () => {\n            refreshBtn.setAttribute('disabled', 'true');\n            await this.fetchFiles();\n            refreshBtn.removeAttribute('disabled');\n        });\n        buttonContainer.appendChild(refreshBtn);\n        // Create the link button using jp-button.\n        const linkBtn = document.createElement('jp-button');\n        linkBtn.setAttribute('appearance', 'stealth');\n        linkBtn.setAttribute('scale', 'medium');\n        linkBtn.setAttribute('title', 'Link to CPG Portal');\n        linkBtn.innerHTML = launchIcon.svgstr;\n        linkBtn.addEventListener('click', async () => {\n            window.open('https://portal.cpg.unimelb.edu.au/files', '_blank');\n        });\n        buttonContainer.appendChild(linkBtn);\n        headerContainer.node.appendChild(buttonContainer);\n        layout.addWidget(headerContainer);\n        // add a description\n        const description = new Widget();\n        description.node.textContent =\n            'Browse files on the CPG Portal. Use the download button to save files to your Secure Analysis Environment.';\n        description.node.style.paddingLeft = '4px';\n        description.node.style.paddingRight = '4px';\n        description.node.style.paddingBottom = '8px';\n        description.node.style.fontSize = '0.8em';\n        description.node.style.color = 'var(--jp-ui-font-color2)';\n        description.node.style.borderBottom = '1px solid #ddd';\n        layout.addWidget(description);\n        // Create the container that will hold the file list.\n        this._fileListContainer = new Widget();\n        this._fileListContainer.node.style.overflowY = 'auto';\n        this._fileListContainer.node.style.overflowX = 'hidden';\n        this._fileListContainer.node.style.padding = '4px';\n        this._fileListContainer.node.style.paddingTop = '0px';\n        // Set a max-height to prevent the file list from taking up the entire panel.\n        this._fileListContainer.node.style.maxHeight = 'calc(100vh - 100px)';\n        layout.addWidget(this._fileListContainer);\n        // Listen for theme changes.\n        // addJupyterLabThemeChangeListener();\n    }\n    /**\n     * Fetch the list of files from the drive.\n     */\n    async fetchFiles() {\n        this._clearFileList();\n        try {\n            // Fetch the root directory. Change '' to another path if needed.\n            const model = await this._drive.get('', { content: true });\n            if (!model.content ||\n                (Array.isArray(model.content) && model.content.length === 0)) {\n                this._showMessage('No files found.');\n                return;\n            }\n            // Add a header row.\n            this._addFileListHeader();\n            // Iterate over the directory contents.\n            for (const file of model.content) {\n                this._addFileRow(file);\n            }\n        }\n        catch (error) {\n            this._showError(`Error fetching files: ${String(error)}`);\n            console.error('Error fetching files:', error);\n        }\n    }\n    /**\n     * Clear all content from the file list container.\n     */\n    _clearFileList() {\n        while (this._fileListContainer.node.firstChild) {\n            this._fileListContainer.node.removeChild(this._fileListContainer.node.firstChild);\n        }\n    }\n    /**\n     * Display an error message.\n     */\n    _showError(message) {\n        const errorWidget = new Widget();\n        errorWidget.node.textContent = message;\n        errorWidget.addClass('cpg-portal-error');\n        this._fileListContainer.node.appendChild(errorWidget.node);\n    }\n    /**\n     * Display a simple informational message.\n     */\n    _showMessage(message) {\n        const msgWidget = new Widget();\n        msgWidget.node.textContent = message;\n        msgWidget.addClass('cpg-portal-message');\n        this._fileListContainer.node.appendChild(msgWidget.node);\n    }\n    /**\n     * Add a header row to the file list.\n     */\n    _addFileListHeader() {\n        const header = new Widget();\n        header.node.style.display = 'flex';\n        header.node.style.fontWeight = 'bold';\n        header.node.style.paddingLeft = '4px';\n        header.node.style.paddingBottom = '4px';\n        header.node.style.paddingTop = '4px';\n        header.node.style.borderBottom = '1px solid #ddd';\n        header.node.style.position = 'sticky';\n        header.node.style.top = '0';\n        header.node.style.zIndex = '1';\n        header.node.style.backgroundColor = 'var(--jp-layout-color1)';\n        header.node.style.color = 'var(--jp-ui-font-color1)';\n        header.node.style.fontSize = 'var(--jp-ui-font-size1)';\n        const nameCol = new Widget();\n        nameCol.node.textContent = 'File Name';\n        nameCol.node.style.flex = '4';\n        const createdCol = new Widget();\n        createdCol.node.textContent = 'Created';\n        createdCol.node.style.flex = '2';\n        createdCol.node.style.textAlign = 'right';\n        const sizeCol = new Widget();\n        sizeCol.node.textContent = 'Size';\n        sizeCol.node.style.flex = '2';\n        sizeCol.node.style.textAlign = 'right';\n        const actionCol = new Widget();\n        actionCol.node.style.flex = '1';\n        actionCol.node.style.textAlign = 'right';\n        actionCol.node.style.width = '25px';\n        header.node.appendChild(nameCol.node);\n        header.node.appendChild(createdCol.node);\n        header.node.appendChild(sizeCol.node);\n        header.node.appendChild(actionCol.node);\n        this._fileListContainer.node.appendChild(header.node);\n    }\n    /**\n     * Add a row widget for an individual file.\n     *\n     * @param file - A Contents.IModel representing a file or directory.\n     */\n    _addFileRow(file) {\n        const row = new Widget();\n        row.node.style.display = 'flex';\n        row.node.style.alignItems = 'center';\n        row.node.style.paddingLeft = '4px';\n        // File name column.\n        const nameWidget = new Widget();\n        nameWidget.node.textContent = file.name;\n        nameWidget.node.style.flex = '4';\n        nameWidget.node.style.whiteSpace = 'nowrap';\n        nameWidget.node.style.overflow = 'hidden';\n        nameWidget.node.style.textOverflow = 'ellipsis';\n        // Created date column.\n        const createdWidget = new Widget();\n        const created = file.created_at\n            ? this._timeSince(new Date(file.created_at))\n            : '';\n        createdWidget.node.textContent = created;\n        createdWidget.node.style.flex = '2';\n        createdWidget.node.style.textAlign = 'right';\n        createdWidget.node.style.whiteSpace = 'nowrap';\n        // Size column (if available).\n        const sizeWidget = new Widget();\n        const size = file.size\n            ? this._formatBytes(file.size, 0)\n            : '';\n        sizeWidget.node.textContent = size;\n        sizeWidget.node.style.flex = '2';\n        sizeWidget.node.style.textAlign = 'right';\n        sizeWidget.node.style.whiteSpace = 'nowrap';\n        // Action column (download button for files).\n        const actionWidget = new Widget();\n        actionWidget.node.style.flex = '1';\n        actionWidget.node.style.textAlign = 'right';\n        actionWidget.node.style.width = '25px';\n        const designSystemProvider = document.createElement('jp-design-system-provider');\n        designSystemProvider.style.width = 'auto';\n        const downloadBtn = document.createElement('jp-button');\n        downloadBtn.setAttribute('appearance', 'stealth');\n        downloadBtn.setAttribute('scale', 'medium');\n        downloadBtn.classList.add('download-btn');\n        downloadBtn.setAttribute('title', 'Download File');\n        downloadBtn.innerHTML = `\n      <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"1.5\" stroke=\"currentColor\" class=\"size-6\">\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3\" />\n      </svg>\n    `;\n        downloadBtn.addEventListener('click', async () => {\n            downloadBtn.setAttribute('disabled', 'true');\n            const originalContent = downloadBtn.innerHTML;\n            downloadBtn.innerHTML =\n                '<jp-progress-ring style=\"height: 17px;\"></jp-progress-ring>';\n            await this.downloadFile(file);\n            downloadBtn.removeAttribute('disabled');\n            downloadBtn.innerHTML = originalContent;\n        });\n        designSystemProvider.appendChild(downloadBtn);\n        actionWidget.node.appendChild(designSystemProvider);\n        row.node.appendChild(nameWidget.node);\n        row.node.appendChild(createdWidget.node);\n        row.node.appendChild(sizeWidget.node);\n        row.node.appendChild(actionWidget.node);\n        this._fileListContainer.node.appendChild(row.node);\n    }\n    /**\n     * Format bytes into a human-readable string.\n     */\n    _formatBytes(bytes, decimals = 2) {\n        if (bytes === 0) {\n            return '0 B';\n        }\n        const k = 1024;\n        const dm = decimals < 0 ? 0 : decimals;\n        const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];\n        const i = Math.floor(Math.log(bytes) / Math.log(k));\n        return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];\n    }\n    /**\n     * Calculate the time elapsed since a given date.\n     * @param date - The date to calculate from.\n     * @returns A string representing the elapsed time.\n     */\n    _timeSince(date) {\n        const seconds = Math.floor((new Date().getTime() - date.getTime()) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval >= 1) {\n            return interval + 'Y' + ' ago';\n        }\n        interval = Math.floor(seconds / 2592000);\n        if (interval >= 1) {\n            return interval + 'M' + ' ago';\n        }\n        interval = Math.floor(seconds / 86400);\n        if (interval >= 1) {\n            return interval + 'd' + ' ago';\n        }\n        interval = Math.floor(seconds / 3600);\n        if (interval >= 1) {\n            return interval + 'h' + ' ago';\n        }\n        interval = Math.floor(seconds / 60);\n        if (interval >= 1) {\n            return interval + 'm' + ' ago';\n        }\n        return Math.floor(seconds) + 's' + ' ago';\n    }\n    /**\n     * Download a file using the drive's getDownloadUrl method.\n     * @param file - The Contents.IModel representing the file.\n     */\n    async downloadFile(file) {\n        try {\n            const url = await this._drive.getDownloadUrl(file.id);\n            const response = await fetch(url, {\n                headers: {\n                    Authorization: `Bearer ${this._drive.accessToken}`\n                }\n            });\n            if (!response.ok) {\n                return;\n            }\n            const blob = await response.blob();\n            // Save file based on MIME type.\n            if (blob.type.startsWith('text/')) {\n                const textContent = await blob.text();\n                await this._app.serviceManager.contents.save(file.name, {\n                    type: 'file',\n                    format: 'text',\n                    content: textContent\n                });\n            }\n            else {\n                const reader = new FileReader();\n                reader.onload = async (event) => {\n                    var _a;\n                    const dataUrl = (_a = event.target) === null || _a === void 0 ? void 0 : _a.result;\n                    if (typeof dataUrl === 'string') {\n                        const base64Data = dataUrl.split(',')[1];\n                        try {\n                            await this._app.serviceManager.contents.save(file.name, {\n                                type: 'file',\n                                format: 'base64',\n                                content: base64Data\n                            });\n                        }\n                        catch (error) {\n                            console.error('Error saving file:', error);\n                        }\n                    }\n                };\n                reader.readAsDataURL(blob);\n            }\n        }\n        catch (error) {\n            console.error(`Error downloading file ${file.name}:`, error);\n        }\n    }\n}\n","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\nimport { Signal } from '@lumino/signaling';\nimport { URLExt } from '@jupyterlab/coreutils';\nimport { ObservableValue } from '@jupyterlab/observables';\nimport { ServerConnection } from '@jupyterlab/services';\nexport const DEFAULT_CPG_PORTAL_BASE_URL = 'https://portal.cpg.unimelb.edu.au';\n/**\n * A Contents.IDrive implementation that serves as a read-only\n * view onto GitLab repositories.\n */\nexport class CPGPortalDrive {\n    /**\n     * Construct a new drive object.\n     *\n     * @param options - The options used to initialize the object.\n     */\n    constructor(registry) {\n        this._baseUrl = '';\n        this._validToken = false;\n        this._isDisposed = false;\n        this._fileChanged = new Signal(this);\n        this._serverSettings = ServerConnection.makeSettings();\n        this.baseUrl = DEFAULT_CPG_PORTAL_BASE_URL;\n        this.errorState = new ObservableValue(false);\n    }\n    /**\n     * The name of the drive.\n     */\n    get name() {\n        return 'CPG Portal';\n    }\n    /**\n     * State for whether the user is valid.\n     */\n    get validToken() {\n        return this._validToken;\n    }\n    /**\n     * Settings for the notebook server.\n     */\n    get serverSettings() {\n        return this._serverSettings;\n    }\n    /**\n     * A signal emitted when a file operation takes place.\n     */\n    get fileChanged() {\n        return this._fileChanged;\n    }\n    /**\n     * Test whether the manager has been disposed.\n     */\n    get isDisposed() {\n        return this._isDisposed;\n    }\n    /**\n     * Dispose of the resources held by the manager.\n     */\n    dispose() {\n        if (this.isDisposed) {\n            return;\n        }\n        this._isDisposed = true;\n        Signal.clearData(this);\n    }\n    /**\n     * The GitLab base URL\n     */\n    get baseUrl() {\n        return this._baseUrl;\n    }\n    /**\n     * The GitLab base URL is set by the settingsRegistry change hook\n     */\n    set baseUrl(url) {\n        this._baseUrl = url;\n    }\n    /**\n     * The GitLab access token\n     */\n    get accessToken() {\n        return this._accessToken;\n    }\n    /**\n     * The GitLab access token is set by the settingsRegistry change hook\n     */\n    set accessToken(token) {\n        this._accessToken = token;\n    }\n    // Minimal implementation of 'get' to fetch a directory model.\n    async get(path, options) {\n        const url = URLExt.join(this.baseUrl, 'api', 'v1', 'files');\n        console.log('Fetching files from', url);\n        console.log('Using access token', this.accessToken);\n        const response = await fetch(url, {\n            headers: {\n                Authorization: `Bearer ${this.accessToken}`\n            }\n        });\n        if (!response.ok) {\n            this.errorState.set(true);\n            if (response.status === 401) {\n                this._validToken = false;\n                throw new Error('Invalid access token');\n            }\n            throw new Error(`Error fetching files: ${response.statusText}`);\n        }\n        this._validToken = true;\n        this.errorState.set(false);\n        const data = await response.json();\n        const files = data.data || [];\n        return {\n            name: '',\n            path: '',\n            format: 'json',\n            type: 'directory',\n            created: '',\n            last_modified: '',\n            writable: false,\n            mimetype: '',\n            content: files\n        };\n    }\n    async getDownloadUrl(path) {\n        return URLExt.join(this.baseUrl, 'api', 'v1', 'files', path, 'download');\n    }\n    /**\n     * Create a new untitled file or directory in the specified directory path.\n     *\n     * @param options: The options used to create the file.\n     *\n     * @returns A promise which resolves with the created file content when the\n     *    file is created.\n     */\n    newUntitled(options = {}) {\n        return Promise.reject('Repository is read only');\n    }\n    /**\n     * Delete a file.\n     *\n     * @param path - The path to the file.\n     *\n     * @returns A promise which resolves when the file is deleted.\n     */\n    delete(path) {\n        return Promise.reject('Repository is read only');\n    }\n    /**\n     * Rename a file or directory.\n     *\n     * @param path - The original file path.\n     *\n     * @param newPath - The new file path.\n     *\n     * @returns A promise which resolves with the new file contents model when\n     *   the file is renamed.\n     */\n    rename(path, newPath) {\n        return Promise.reject('Repository is read only');\n    }\n    /**\n     * Save a file.\n     *\n     * @param path - The desired file path.\n     *\n     * @param options - Optional overrides to the model.\n     *\n     * @returns A promise which resolves with the file content model when the\n     *   file is saved.\n     */\n    save(path, options) {\n        return Promise.reject('Repository is read only');\n    }\n    /**\n     * Copy a file into a given directory.\n     *\n     * @param path - The original file path.\n     *\n     * @param toDir - The destination directory path.\n     *\n     * @returns A promise which resolves with the new contents model when the\n     *  file is copied.\n     */\n    copy(fromFile, toDir) {\n        return Promise.reject('Repository is read only');\n    }\n    /**\n     * Create a checkpoint for a file.\n     *\n     * @param path - The path of the file.\n     *\n     * @returns A promise which resolves with the new checkpoint model when the\n     *   checkpoint is created.\n     */\n    createCheckpoint(path) {\n        return Promise.reject('Repository is read only');\n    }\n    /**\n     * List available checkpoints for a file.\n     *\n     * @param path - The path of the file.\n     *\n     * @returns A promise which resolves with a list of checkpoint models for\n     *    the file.\n     */\n    listCheckpoints(path) {\n        return Promise.resolve([]);\n    }\n    /**\n     * Restore a file to a known checkpoint state.\n     *\n     * @param path - The path of the file.\n     *\n     * @param checkpointID - The id of the checkpoint to restore.\n     *\n     * @returns A promise which resolves when the checkpoint is restored.\n     */\n    restoreCheckpoint(path, checkpointID) {\n        return Promise.reject('Repository is read only');\n    }\n    /**\n     * Delete a checkpoint for a file.\n     *\n     * @param path - The path of the file.\n     *\n     * @param checkpointID - The id of the checkpoint to delete.\n     *\n     * @returns A promise which resolves when the checkpoint is deleted.\n     */\n    deleteCheckpoint(path, checkpointID) {\n        return Promise.reject('Read only');\n    }\n}\n","import { ILayoutRestorer } from '@jupyterlab/application';\nimport { ICommandPalette, WidgetTracker } from '@jupyterlab/apputils';\nimport { showDialog, Dialog } from '@jupyterlab/apputils';\nimport { LabIcon } from '@jupyterlab/ui-components';\nimport { ISettingRegistry } from '@jupyterlab/settingregistry';\nimport { CPGPortalDrive, DEFAULT_CPG_PORTAL_BASE_URL } from './contents';\nimport { CPGPortalFilesWidget } from './CPGPortalFilesWidget';\n/**\n * CPG filebrowser plugin state namespace.\n */\nconst NAMESPACE = 'jupyterlab_cpg_portal';\n/**\n * The ID for the plugin.\n */\nconst PLUGIN_ID = `${NAMESPACE}:plugin`;\nconst COMMAND_ID = `${NAMESPACE}:open`;\n/**\n * CPG Icon class.\n */\nexport const cpgLabIcon = new LabIcon({\n    name: `${NAMESPACE}:icon`,\n    svgstr: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0.872 0.137 505.152 505.152\" width=\"500px\" height=\"500px\">\n    <path fill=\"#616161\" class=\"jp-icon3 jp-icon-selectable\" d=\"M 506.024 252.713 C 506.024 392.207 392.942 505.289 253.448 505.289 C 113.954 505.289 0.872 392.207 0.872 252.713 C 0.872 113.219 113.954 0.137 253.448 0.137 C 392.942 0.137 506.024 113.219 506.024 252.713 Z M 186.982 369.339 C 193.183 373.48 199.997 372.091 207.298 365.898 C 213.97 360.237 221.452 357.069 230.408 357.256 C 241.725 357.492 253.092 357.873 264.364 357.107 C 280.136 356.036 294.673 358.319 307.212 368.674 C 307.839 369.192 308.623 369.814 309.363 369.854 C 313.68 370.09 318.395 371.331 322.243 370.043 C 329.215 367.708 331.892 361.413 332.29 354.328 C 332.748 346.173 330.422 339.048 322.977 334.826 C 316.421 331.108 310.296 333.967 305.164 338.035 C 296.45 344.942 286.817 348.051 275.759 347.77 C 264.61 347.487 253.428 347.302 242.296 347.83 C 227.901 348.514 214.983 345.817 203.316 336.555 C 194.474 329.537 184.494 332.992 180.161 343.547 C 177.744 349.436 177.884 355.487 180.294 361.795 C 182.635 364.564 184.376 367.599 186.982 369.339 Z M 307.553 413.442 C 308.65 410.086 309.262 406.466 309.433 402.934 C 309.808 395.205 306.952 388.805 299.613 385.587 C 292.503 382.47 286.315 384.718 280.55 389.763 C 274.07 395.434 266.062 397.802 257.536 398.525 C 246.551 399.455 237.448 394.946 228.62 389.112 C 225.428 387.003 221.615 384.865 217.961 384.622 C 209.905 384.087 202.896 389.406 201.789 397.021 C 200.106 408.61 201.215 415.556 209.631 420.665 C 215.962 424.509 222.964 423.433 230.391 417.29 C 237.895 411.082 246.68 407.864 256.075 407.96 C 267.191 408.074 276.82 413.072 285.44 420.633 C 294.506 425.486 304.877 421.625 307.553 413.442 Z M 308.743 307.256 C 310.933 299.011 307.857 289.148 301.535 284.858 C 295.981 281.09 289.754 281.971 281.846 287.638 C 281.035 288.219 280.219 288.795 279.388 289.347 C 268.755 296.404 257.124 299.453 244.821 295.541 C 238.477 293.524 232.594 289.694 226.905 286.054 C 216.852 279.623 211.346 280.782 204.59 290.187 C 202.428 293.196 201.486 297.606 201.342 301.426 C 201.061 308.828 204.011 315.238 210.702 318.968 C 217.223 322.602 223.086 320.09 228.589 315.96 C 231.868 313.499 235.137 310.673 238.881 309.244 C 256.344 302.577 272.035 306.045 286.136 318.703 C 296.887 324.302 306.099 317.206 308.743 307.256 Z M 282.369 84.005 C 268.181 96.065 245.611 96.6 231.902 85.935 C 228.283 83.12 223.982 81.055 219.744 79.223 C 217.877 78.416 215.129 78.392 213.225 79.142 C 204.584 82.545 200.579 90.582 201.902 101.18 C 202.754 108.001 206.212 113.093 212.731 115.521 C 218.674 117.734 223.656 115.515 228.317 111.588 C 231.047 109.286 234.151 106.998 237.481 105.909 C 254.322 100.402 270.291 100.448 284.613 113.176 C 290.798 118.673 298.54 117.396 304.191 111.359 C 313.85 101.041 308.734 82.718 294.722 78.931 C 290.282 80.565 285.515 81.331 282.369 84.005 Z M 203.052 192.407 C 199.658 200.575 202.148 210.446 208.721 215.452 C 214.874 220.14 221.238 219.337 229.464 212.836 C 245.039 200.527 266.514 200.89 282.883 213.74 C 293.681 222.217 305.265 218.22 308.641 204.853 C 310.718 196.627 307.512 187.235 301.197 183.051 C 295.371 179.19 289.89 180.056 281.764 186.122 C 281.231 186.52 280.721 186.951 280.171 187.323 C 266.352 196.675 252.04 198.463 237.103 190.055 C 233.632 188.102 230.182 186.103 226.806 183.992 C 219.004 179.113 213.411 179.705 206.476 186.517 C 205.162 188.658 203.871 190.435 203.052 192.407 Z M 248.733 429.27 C 240.563 431.96 235.793 442.375 240.423 453.072 C 243.231 459.561 255.123 463.109 262.432 459.85 C 270.222 456.376 273.308 449.618 271.64 439.68 C 270.582 433.38 264.051 428.555 255.901 428.379 C 253.211 428.655 250.844 428.574 248.733 429.27 Z M 244.587 238.718 C 239.495 243.61 238.371 249.566 240.553 256.069 C 242.78 262.707 248.357 266.319 255.46 266.199 C 263 266.072 268.105 262.546 270.271 255.969 C 272.736 248.486 270.703 242.217 263.831 236.968 C 255.895 233.368 249.512 233.988 244.587 238.718 Z M 266.078 74.647 C 271.286 69.852 272.628 61.199 269.171 54.978 C 265.778 48.875 258.105 45.732 251.172 47.607 C 244.002 49.546 239.606 55.504 239.723 63.126 C 239.905 75.061 250.167 81.082 263.336 76.585 C 264.463 75.802 265.353 75.314 266.078 74.647 Z M 184.728 163.897 C 190.93 168.038 197.744 166.649 205.044 160.455 C 211.716 154.795 219.199 151.627 228.154 151.813 C 239.472 152.049 250.839 152.431 262.111 151.665 C 277.882 150.593 292.419 152.877 304.958 163.231 C 305.586 163.749 306.369 164.371 307.109 164.412 C 311.426 164.648 316.141 165.888 319.989 164.6 C 326.962 162.266 329.639 155.97 330.037 148.886 C 330.494 140.731 328.168 133.605 320.723 129.383 C 314.167 125.666 308.043 128.525 302.911 132.592 C 294.196 139.5 284.563 142.608 273.505 142.327 C 262.356 142.044 251.174 141.859 240.043 142.388 C 225.647 143.071 212.73 140.374 201.063 131.113 C 192.221 124.094 182.241 127.55 177.908 138.105 C 175.49 143.994 175.631 150.045 178.041 156.352 C 180.382 159.121 182.123 162.157 184.728 163.897 Z\"   />\n  </svg>`\n});\n/**\n * The JupyterLab plugin for the CPG Portal Filebrowser.\n */\nconst fileBrowserPlugin = {\n    id: PLUGIN_ID,\n    requires: [ICommandPalette],\n    optional: [ILayoutRestorer, ISettingRegistry],\n    activate: activateFileBrowser,\n    autoStart: true\n};\n/**\n * Activate the file browser.\n */\nfunction activateFileBrowser(app, palette, restorer, settingRegistry) {\n    let widget = null;\n    // Show a welcome pop-up dialog when JupyterLab loads\n    showDialog({\n        title: 'Welcome to the CPG Secure Analysis Environment!',\n        body: 'This JupyterLite environment is running isolated in you browser. Any files you add here will not leave your computer. To access files on the CPG Portal, click the CPG Portal icon on the left. You can use this environment to run code, visualise data, and create reports.',\n        buttons: [Dialog.okButton({ label: 'Got it!' })]\n    });\n    app.commands.addCommand(COMMAND_ID, {\n        label: 'Open CPG Portal Files',\n        execute: async () => {\n            const drive = new CPGPortalDrive(app.docRegistry);\n            if (settingRegistry) {\n                const settings = await settingRegistry.load(PLUGIN_ID);\n                console.log(settings);\n                const baseUrl = settings.get('portalUrl').composite;\n                const accessToken = settings.get('apiToken').composite;\n                drive.baseUrl = baseUrl || DEFAULT_CPG_PORTAL_BASE_URL;\n                drive.accessToken =\n                    accessToken || window.localStorage.getItem('access_token');\n            }\n            // Create the widget if it doesn't exist.\n            if (!widget || widget.isDisposed) {\n                widget = new CPGPortalFilesWidget(app, drive);\n                widget.title.icon = cpgLabIcon;\n                widget.title.iconClass = 'jp-SideBar-tabIcon';\n                widget.title.caption = 'Browse CPG Portal';\n                //widget.id = 'cpg-portal-file-browser';\n            }\n            if (!widget.isAttached) {\n                app.shell.add(widget, 'left', { rank: 102 });\n            }\n            await widget.fetchFiles();\n            app.shell.activateById(widget.id);\n        }\n    });\n    // palette.addItem({ command: COMMAND_ID, category: 'CPG Portal' });\n    const tracker = new WidgetTracker({\n        namespace: NAMESPACE\n    });\n    if (restorer) {\n        restorer.restore(tracker, {\n            command: COMMAND_ID,\n            name: () => NAMESPACE\n        });\n    }\n    // Automatically open the panel on startup.\n    app.commands.execute(COMMAND_ID);\n    return;\n}\nexport default fileBrowserPlugin;\n"],"names":[],"sourceRoot":""}