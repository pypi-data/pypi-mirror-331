import{d as j,i as x,a as _,c as m,o as k,b as Z,B as pe,e as L,f as u,t as B,g as ve,r as R,p as T,w as O,F as me,h as D,u as N,_ as U,j as fe,k as ge,l as ee,m as Y,v as J,n as te,q as _e,s as he,W as ye,x as Ce,y as be,z as oe,A as Se,C as we,D as Pe,E as Ee,G as Ie,H as Te,I as Me,J as $e,K as Q}from"./index-CUGDV1IA.js";import{f as ke}from"./instancePath-BsbOTTI8.js";const Ae=10,De=j({__name:"ChildlessPlaceholder",props:{componentId:{type:String,required:!0}},setup(w){const s=x(_.core),p=w,v=(C,c)=>{const P=C.map(l=>s.getComponentDefinition(l)).map(l=>l==null?void 0:l.name);return`${P.slice(0,-1).join(", ")} ${P.length>1?c:""} ${P.at(-1)}`},r=m(()=>{const C=s.getContainableTypes(p.componentId);let c;return C.length<=Ae&&(c=`You can add ${v(C,"and")} components`),c});return(C,c)=>(k(),Z(pe,{class:"ChildlessPlaceholder","component-id":w.componentId,message:r.value},null,8,["component-id","message"]))}}),Be={class:"RenderError"},Re={class:"title"},xe={class:"message"},Ve=j({__name:"RenderError",props:{componentType:{},message:{}},setup(w){const s=w;return(p,v)=>(k(),L("div",Be,[u("div",Re,[u("h2",null,"Error rendering "+B(s.componentType),1)]),u("div",xe,B(s.message),1)]))}}),Le={props:{componentId:{type:String,required:!0},instancePath:{type:Array,required:!0},instanceData:{type:Array,required:!0}},setup(w){const s=x(_.core),p=x(_.builderManager),v=w.componentId,r=m(()=>s.getComponentById(v)),C=ve(r.value.type),c=w.instancePath,h=w.instanceData,{getEvaluatedFields:P,isComponentVisible:f}=N(s),l=P(c),I=m(()=>s.getComponents(v,{sortedByPosition:!0})),E=m(()=>!!p&&p.getMode()!="preview"),q=m(()=>{var t;return E.value&&!r.value.isCodeManaged&&r.value.type!=="root"&&r.value.type!=="workflows_root"&&((t=A.value)==null?void 0:t.toolkit)!=="workflows"}),F=(t,a)=>(t?s.getContainableTypes(t):["root","workflows_root"]).includes(a),V=R(!1),z=()=>{if(!(I.value.length>0))return D(De,{componentId:r.value.id})},e=(t,a=0,i)=>D(se,{componentId:t,key:`${t}:${a}`,instancePath:[...c,{componentId:t,instanceNumber:a}],instanceData:[...h,R(null)],...i??{}}),o=t=>a=>{if(!F(v,a.type)&&t==="default")return!0;const g=s.getComponentDefinition(a.type).slot??"default";return g==="*"||g===t},n=(t=0,a="default",i=()=>!0,g=!1)=>{const b=y=>!E.value||g?[]:[D("div",{"data-writer-slot-of-id":v,"data-writer-position":y})],S=I.value.filter(o(a)).filter(i),$=S.filter(y=>!y.isCodeManaged).map(y=>e(y.id,t,{contextSlot:a})),W=S.filter(y=>y.isCodeManaged).map(y=>e(y.id,t,{contextSlot:a}));return[...b(0),...$.map((y,H)=>[y,b(H+1)]).flat(),...W]},d=ke(c);T(_.evaluatedFields,l),T(_.componentId,v),T(_.isBeingEdited,E),T(_.isDisabled,V),T(_.instancePath,c),T(_.instanceData,h),T(_.renderProxiedComponent,e),T(_.getChildrenVNodes,n),T(_.flattenedInstancePath,d);const M={"data-writer-id":v,"data-writer-instance-path":d},A=m(()=>s.getComponentDefinition(r.value.type)),K=m(()=>{var t;return(t=A.value)==null?void 0:t.fields}),G=R(!1);O(()=>p==null?void 0:p.isComponentIdSelected(v),t=>{G.value=t});const ne=m(()=>Object.entries(K.value).filter(([,t])=>t.category===me.Style).reduce((t,[a])=>(t[a]=l[a].value,t),{}));O(ne,()=>G.value=!1);const X=m(()=>I.value.length==0),ae=m(()=>f(v,c)),re=(t,a)=>{if((!t||!(t!=null&&t.startsWith("$goToPage_")))&&!a)return g=>{s.forwardEvent(g,c,!0)};if(t!=null&&t.startsWith("$goToPage_")){const g=t.substring(10);return b=>s.setActivePageFromKey(g)}return null},ie=m(()=>{const t={};return Object.keys(A.value.events??{}).forEach(i=>{var S;const g=`on${i.charAt(0).toUpperCase()}${i.slice(1)}`,b=i===((S=r.value.binding)==null?void 0:S.eventType);t[g]=$=>{var y,H;b&&s.forwardEvent($,c,!0);const W=((y=r.value.handlers)==null?void 0:y[i])??null;(H=re(W,b))==null||H($)}}),t}),le=m(()=>{const t=K.value;if(!t)return;const a={};return Object.keys(t).forEach(i=>{t[i].applyStyleVariable&&l[i]&&(a[`--${i}`]=l[i].value)}),a}),ce=m(()=>{const t="cssClasses",a=K.value;if(!a||!a[t]||!l[t])return;const i=String(l[t].value),g=i==null?void 0:i.split(" ").map(S=>S.trim()),b={};return g.forEach(S=>{b[S]=!0}),b}),de=function(){return{class:{[`wf-type-${r.value.type}`]:!0,component:!0,childless:X.value,selected:G.value,disabled:V.value,beingEdited:E.value,...ce.value},style:{...le.value,...ae.value?{}:{display:"none"}},...M,...V.value?[]:ie.value,draggable:q.value}},ue=(t,a)=>E.value?D(Ve,{...t,componentType:r.value.type,message:a}):D("div");return()=>{const t=E.value?z():void 0,a=({instanceNumber:g=0,slotName:b="default",componentFilter:S=()=>!0,positionlessSlot:$=!1})=>X.value?$?void 0:t:n(g,b,S,$),i={...de()};return F(r.value.parentId,r.value.type)?D(C,i,{default:a}):ue(i,"Parent is not suitable for this component")}}},se=U(Le,[["__scopeId","data-v-e606b8cb"]]),Fe={class:"counter"},We={class:"main"},He={class:"clearContainer"},Oe={class:"content"},je={class:"title"},qe={class:"time"},ze={class:"message"},Ke=100,Ge=j({__name:"RendererNotifications",setup(w){const s=x(_.core),p=R(!1),v=fe("balloon"),r=ge([]),C=P=>{const{type:f,title:l,message:I,code:E}=P;r.unshift({type:f,title:l,message:I,code:E,timestampReceived:new Date}),r.splice(Ke),v.value.classList.remove("alert"),v.value.offsetWidth,v.value.classList.add("alert")};ee(()=>{s.addMailSubscription("notification",C)});const c=()=>{r.length!=0&&(p.value=!p.value)},h=()=>{r.splice(0),p.value=!1};return(P,f)=>Y((k(),L("div",{class:"RendererNotifications colorTransformer",onClick:c},[u("div",{ref_key:"balloon",ref:v,class:"balloon",title:"Toggle notifications"},[f[0]||(f[0]=u("i",{class:"icon material-symbols-outlined"}," notifications ",-1)),u("div",Fe,B(r.length),1)],512),f[3]||(f[3]=u("div",{class:"balloonFlash"},null,-1)),Y(u("div",We,[u("div",He,[te(ye,{onClick:h},{default:_e(()=>f[1]||(f[1]=[u("i",{class:"material-symbols-outlined"}," clear_all ",-1),he(" Clear all ")])),_:1})]),(k(!0),L(Ce,null,be(r,(l,I)=>(k(),L("div",{key:I,class:"notification"},[u("div",{class:oe(["icon",l.type])},f[2]||(f[2]=[u("i",{class:"material-symbols-outlined"}," exclamation ",-1)]),2),u("div",Oe,[u("header",null,[u("strong",je,B(l.title),1),u("span",qe,B(l.timestampReceived.toLocaleTimeString()),1)]),u("div",ze,B(l.message),1)])]))),128))],512),[[J,p.value]])],512)),[[J,r.length>0]])}}),Ue=U(Ge,[["__scopeId","data-v-0ffb1f63"]]),Xe={class:"rootComponentArea"},Ye=j({__name:"ComponentRenderer",setup(w){const s=x(_.core),p=x(_.builderManager),v=N(s),r={},C=R({}),c=m(()=>(p==null?void 0:p.activeRootId.value)??"root");O(c,(e,o)=>{var d;C.value[o]=s.activePageId;const n=(d=C.value)==null?void 0:d[e];n&&s.setActivePageId(n)});const h=v.getEvaluatedFields([{componentId:"root",instanceNumber:0}]),P=m(()=>{var e,o,n,d,M,A;return{...Se,"--accentColor":(e=h.accentColor)==null?void 0:e.value,"--emptinessColor":(o=h.emptinessColor)==null?void 0:o.value,"--containerBackgroundColor":(n=h.parentIdBackgroundColor)==null?void 0:n.value,"--primaryTextColor":(d=h.primaryTextColor)==null?void 0:d.value,"--secondaryTextColor":(M=h.secondaryTextColor)==null?void 0:M.value,"--separatorColor":(A=h.separatorColor)==null?void 0:A.value}}),f=m(()=>s.frontendMessageMap.value.size>0);O(()=>{var e;return(e=h.appName)==null?void 0:e.value},e=>{e!=""&&l(e)},{immediate:!0});function l(e){const o=s.mode.value;let n;e&&o=="edit"?n=`${e} | Writer Framework | Builder`:!e&&o=="edit"?n="Writer Framework | Builder":e&&o=="run"?n=`${e}`:!e&&o=="run"&&(n="Writer Framework App"),document.title=n}async function I(e,o){const n=document.querySelector(`[data-writer-stylesheet-key="${e}"]`);n==null||n.remove();const d=document.createElement("link");d.dataset.writerStylesheetKey=e,d.setAttribute("href",o),d.setAttribute("rel","stylesheet"),document.head.appendChild(d)}async function E(e,o){const n=document.querySelector(`[data-writer-script-key="${e}"]`);n==null||n.remove();const d=document.createElement("script");d.dataset.writerScriptKey=e,d.src=o,d.setAttribute("rel","modulepreload"),document.head.appendChild(d)}async function q(e,o){r[e]=o,await Q(()=>import(o),[],import.meta.url)}async function F(e,o,n){const d=r[e],M=await Q(()=>import(d),[],import.meta.url);if(!M){console.warn(`The module with key "${e}" cannot be found. Please check that it has been imported.`);return}M[o](...n)}function V(){s.addMailSubscription("fileDownload",e=>{const o=document.createElement("a");o.href=e.data,o.download=e.fileName,o.click()}),s.addMailSubscription("openUrl",e=>{const o=document.createElement("a");o.href=e,o.target="_blank",o.rel="noopener noreferrer",o.click()}),s.addMailSubscription("pageChange",async e=>{p.setMode("ui"),await Ie(),Te(e),s.setActivePageFromKey(e)}),s.addMailSubscription("routeVarsChange",e=>{Me(e)}),s.addMailSubscription("importStylesheet",({stylesheetKey:e,path:o})=>{I(e,o)}),s.addMailSubscription("importScript",({scriptKey:e,path:o})=>{E(e,o)}),s.addMailSubscription("importModule",({moduleKey:e,specifier:o})=>{q(e,o)}),s.addMailSubscription("functionCall",({moduleKey:e,functionName:o,args:n})=>{F(e,o,n)})}function z(){const e=$e(),o=new CustomEvent("wf-app-open",{detail:{payload:e}}),n={componentId:"root",instanceNumber:0};s.forwardEvent(o,[n],!0)}return we(()=>{V()}),ee(()=>{z()}),(e,o)=>(k(),L("main",{class:oe(["ComponentRenderer",{loadingActive:f.value}]),tabindex:"-1",style:Ee(P.value)},[te(Ue,{class:"notifications"}),o[0]||(o[0]=u("div",{class:"loadingBar"},null,-1)),u("div",Xe,[(k(),Z(se,{key:c.value,"component-id":c.value,"instance-path":[{componentId:c.value,instanceNumber:0}],"instance-data":[R(null)]},null,8,["component-id","instance-path","instance-data"])),Pe(e.$slots,"default",{},void 0,!0)])],6))}}),Ze=U(Ye,[["__scopeId","data-v-4d3434ac"]]);export{Ze as default};
