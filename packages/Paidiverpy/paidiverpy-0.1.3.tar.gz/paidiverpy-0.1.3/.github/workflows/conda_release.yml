name: Publish to Conda Forge

on:
  push:
  #   branches:
  #     - main
  # pull_request:
  #   branches:
  #     - main

jobs:
  build-and-publish:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3


    - name: Set up Miniconda
      uses: conda-incubator/setup-miniconda@v3
      with:
        python-version: ${{ matrix.python-version }}

    - name: Initialize Conda
      run: |
        conda init bash

    - name: Install Conda and dependencies
      run: |
        source ~/.bashrc
        conda install -c conda-forge conda-smithy conda-build
        conda install -c conda-forge toml jinja2

    - name: Run Python script to generate meta.yml
      run: |
        source ~/.bashrc
        python generate_conda_meta.py

    - name: Validate Conda recipe
      run: |
        source ~/.bashrc
        conda-smithy recipe-lint --conda-forge conda_recipes/
        # Check if there are linting issues
        if [ $? -ne 0 ]; then
          echo "Linting failed due to validation problems."
          exit 1
        fi

    # - name: Build Conda package with Conda Forge recipe
    #   run: |
    #     conda build --output-folder conda-build .  # Build the package from meta.yml

    # - name: Push changes to Conda Forge feedstock
    #   uses: ad-m/github-push-action@v0.6
    #   with:
    #     github_token: ${{ secrets.GITHUB_TOKEN }}  # Automatically pushes to the feedstock repo

    # # Step 7: Trigger the Conda Forge build for your package
    # - name: Trigger Conda Forge build
    #   run: |
    #     echo "Your changes are now pushed to Conda Forge, triggering a build."
