<p align="center">
    <a>
        <img src="https://raw.githubusercontent.com/gri-gus/alchemica/main/assets/cover.jpg" alt="alchemica">
    </a>
</p>


<p align="center">
    <a href="https://pypi.org/project/alchemica" target="_blank">
        <img src="https://img.shields.io/pypi/v/alchemica" alt="PyPI">
    </a>
    <a href="https://pypi.org/project/alchemica" target="_blank">
        <img src="https://static.pepy.tech/badge/alchemica" alt="PyPI">
    </a>
    <a href="https://opensource.org/licenses/Apache-2.0" target="_blank">
        <img src="https://img.shields.io/badge/License-Apache_2.0-blue.svg" alt="Apache">
    </a>
</p>

# Alchemica - SQLAlchemy Logger

**Alchemica** ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏ –≥–∏–±–∫–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ Python-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —Å
SQLAlchemy.
–û–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π, —Ç–∞–∫ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã, –∞ —Ç–∞–∫–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã—Ö –∏
–º–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω—ã—Ö —Å—Ä–µ–¥–∞—Ö. Alchemica –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤, –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Ö
–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –≤—ã—è–≤–ª—è—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã.

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

1. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤**
    * –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ SQL-–∑–∞–ø—Ä–æ—Å—ã, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ —á–µ—Ä–µ–∑ SQLAlchemy, –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∑–∞–¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.

    * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, —Ç–∞–∫ –∏ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ (—á–µ—Ä–µ–∑
      `compile_sql=True`).

    * –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º (query_uuid), —á—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ.

2. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–æ–≤**
    * –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏, —Ç–∞–∫ –∏ —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏.

    * –î–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `sync_sql_logger`.

    * –î–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `async_sql_logger`.

3. **–ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–∞—è –∏ –º–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞**
    * –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã—Ö –∏ –º–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω—ã—Ö —Å—Ä–µ–¥–∞—Ö.

    * –ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –∏–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –∏–º–µ–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —á—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.

4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**
    * –ó–∞–º–µ—Ä—è–µ—Ç –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ SQL-–∑–∞–ø—Ä–æ—Å–∞.

    * –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç, –µ—Å–ª–∏ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–µ–≤—ã—à–∞–µ—Ç –∑–∞–¥–∞–Ω–Ω—ã–π –ø–æ—Ä–æ–≥ (`critical_time`).

5. **–ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤** (`EXPLAIN`)
    * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

    * –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

6. **–ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**
    * –ü–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (`log_level`), —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

    * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ (`log_execution_info`), —Ç–∞–∫–æ–π –∫–∞–∫ –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏ –∏
      UUID –∑–∞–ø—Ä–æ—Å–∞.

7. **–ò–∑–æ–ª—è—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**
    * –õ–æ–≥–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ SQL-–∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∑–∞–¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.

    * –ï—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥—Ä—É–≥–∞—è –∑–∞–¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –¥–ª—è –Ω–µ–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

–î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Alchemica –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É:

```shell
pip install alchemica
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º

```python
from alchemica import sync_sql_logger
from sqlalchemy import create_engine, text

# –°–æ–∑–¥–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
engine = create_engine("sqlite:///:memory:")


# –î–µ–∫–æ—Ä–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤
@sync_sql_logger(explain_plan=True)
def execute_query():
    with engine.connect() as conn:
        conn.execute(text("SELECT 1"))


if __name__ == '__main__':
    # –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
    execute_query()

```

–í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å:

```text
2025-03-06 02:39:53,565 - INFO - üöÄ [FUNC](func_name: execute_query; func_uuid: 318df3) –∑–∞–ø—É—â–µ–Ω–∞
2025-03-06 02:39:53,566 - INFO - üü¢ [SQL](func_name: execute_query; func_uuid: 318df3; query_uuid: 353cfd) SELECT 1
2025-03-06 02:39:53,566 - INFO - üìù [SQL PLAN](func_name: execute_query; func_uuid: 318df3; query_uuid: 353cfd) 
0 Init 0 1 0 None 0 None
1 Integer 1 1 0 None 0 None
2 ResultRow 1 1 0 None 0 None
3 Halt 0 0 0 None 0 None
2025-03-06 02:39:53,566 - INFO - üïëÔ∏è [SQL](func_name: execute_query; func_uuid: 318df3; query_uuid: 353cfd) –í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞ 0.0001 —Å–µ–∫
2025-03-06 02:39:53,566 - INFO - ‚úÖ [FUNC](func_name: execute_query; func_uuid: 318df3) –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞ 0.0009 —Å–µ–∫
```

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º

–î–ª—è –ø—Ä–∏–º–µ—Ä–∞ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É `aiosqlite`:

```shell
pip install aiosqlite
```

```python
import asyncio

from alchemica import async_sql_logger
from sqlalchemy import text
from sqlalchemy.ext.asyncio import create_async_engine, AsyncSession

# –°–æ–∑–¥–∞–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
async_engine = create_async_engine("sqlite+aiosqlite:///:memory:")


# –î–µ–∫–æ—Ä–∏—Ä—É–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤
@async_sql_logger()
async def execute_async_query():
    async with AsyncSession(async_engine) as session:
        await session.execute(text("SELECT 1"))


if __name__ == '__main__':
    # –í—ã–ø–æ–ª–Ω—è–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
    asyncio.run(execute_async_query())

```

–í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å:

```text
2025-03-06 02:41:03,244 - INFO - üöÄ [FUNC](func_name: execute_async_query; func_uuid: f01219) –∑–∞–ø—É—â–µ–Ω–∞
2025-03-06 02:41:03,251 - INFO - üü¢ [SQL](func_name: execute_async_query; func_uuid: f01219; query_uuid: 2080d4) SELECT 1
2025-03-06 02:41:03,251 - INFO - üïëÔ∏è [SQL](func_name: execute_async_query; func_uuid: f01219; query_uuid: 2080d4) –í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞ 0.0005 —Å–µ–∫
2025-03-06 02:41:03,252 - INFO - ‚úÖ [FUNC](func_name: execute_async_query; func_uuid: f01219) –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞ 0.0072 —Å–µ–∫
```

## –û–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è sync_sql_logger –∏ async_sql_logger

| –ü–∞—Ä–∞–º–µ—Ç—Ä          | –¢–∏–ø               | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é      | –û–ø–∏—Å–∞–Ω–∏–µ                                                        |
|-------------------|-------------------|-------------------|-----------------------------------------------------------------|
| logger            | logging.Logger    | None              | –õ–æ–≥–≥–µ—Ä –¥–ª—è –∑–∞–ø–∏—Å–∏ —Å–æ–æ–±—â–µ–Ω–∏–π. –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ª–æ–≥–≥–µ—Ä. |
| log_level         | int               | logging.INFO      | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, logging.INFO, logging.DEBUG).     |
| log_execution_info| bool              | True              | –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ (–∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏, UUID –∑–∞–ø—Ä–æ—Å–∞ –∏ —Ç.–¥.). |
| compile_sql       | bool              | False             | –ö–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –ª–∏ SQL-–∑–∞–ø—Ä–æ—Å—ã –ø–µ—Ä–µ–¥ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º.                |
| critical_time     | float             | 1.0               | –í—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–ø—Ä–æ—Å —Å—á–∏—Ç–∞–µ—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω—ã–º.    |
| explain_plan      | bool              | False             | –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ª–∏ –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ (EXPLAIN).                |
| uuid_len          | int               | 6                 | –î–ª–∏–Ω–∞ UUID –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤.                          |

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∫–æ–º–ø–∏–ª—è—Ü–∏–µ–π SQL

```python
@sync_sql_logger(compile_sql=True)
def execute_query():
    with engine.connect() as conn:
        conn.execute(text("SELECT * FROM users WHERE id = :id"), {"id": 1})
```

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–ª–∞–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```python

@sync_sql_logger(explain_plan=True)
def execute_query():
    with engine.connect() as conn:
        conn.execute(text("SELECT * FROM users WHERE id = :id"), {"id": 1})
```

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º –≤—Ä–µ–º–µ–Ω–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```python
@sync_sql_logger(critical_time=0.5)
def execute_query():
    with engine.connect() as conn:
        conn.execute(text("SELECT * FROM users WHERE id = :id"), {"id": 1})
```

## –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

Alchemica –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã—Ö –∏ –º–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω—ã—Ö —Å—Ä–µ–¥–∞—Ö. –ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –∏–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –∏–º–µ–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
–∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —á—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –Ω–∏–º–∏.

### –ü—Ä–∏–º–µ—Ä –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
import threading

from alchemica import sync_sql_logger
from sqlalchemy import create_engine, text

engine = create_engine("sqlite:///:memory:")


@sync_sql_logger()
def execute_query():
    with engine.connect() as conn:
        conn.execute(text("SELECT 1"))


def main():
    # –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤
    threads = []
    for _ in range(3):
        thread = threading.Thread(target=execute_query)
        threads.append(thread)
        thread.start()

    for thread in threads:
        thread.join()


if __name__ == '__main__':
    main()

```

–í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å:

```text
2025-03-06 02:51:15,422 - INFO - üöÄ [FUNC](func_name: execute_query; func_uuid: fa1278) –∑–∞–ø—É—â–µ–Ω–∞
2025-03-06 02:51:15,422 - INFO - üöÄ [FUNC](func_name: execute_query; func_uuid: 0a4fea) –∑–∞–ø—É—â–µ–Ω–∞
2025-03-06 02:51:15,422 - INFO - üöÄ [FUNC](func_name: execute_query; func_uuid: 4f27a3) –∑–∞–ø—É—â–µ–Ω–∞
2025-03-06 02:51:15,423 - INFO - üü¢ [SQL](func_name: execute_query; func_uuid: 4f27a3; query_uuid: 505aac) SELECT 1
2025-03-06 02:51:15,423 - INFO - üïëÔ∏è [SQL](func_name: execute_query; func_uuid: 4f27a3; query_uuid: 505aac) –í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞ 0.0003 —Å–µ–∫
2025-03-06 02:51:15,424 - INFO - ‚úÖ [FUNC](func_name: execute_query; func_uuid: 4f27a3) –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞ 0.0013 —Å–µ–∫
2025-03-06 02:51:15,424 - INFO - üü¢ [SQL](func_name: execute_query; func_uuid: 0a4fea; query_uuid: 16e6c1) SELECT 1
2025-03-06 02:51:15,424 - INFO - üü¢ [SQL](func_name: execute_query; func_uuid: fa1278; query_uuid: 571638) SELECT 1
2025-03-06 02:51:15,424 - INFO - üïëÔ∏è [SQL](func_name: execute_query; func_uuid: fa1278; query_uuid: 571638) –í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞ 0.0001 —Å–µ–∫
2025-03-06 02:51:15,424 - INFO - ‚úÖ [FUNC](func_name: execute_query; func_uuid: fa1278) –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞ 0.0023 —Å–µ–∫
2025-03-06 02:51:15,424 - INFO - üïëÔ∏è [SQL](func_name: execute_query; func_uuid: 0a4fea; query_uuid: 16e6c1) –í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞ 0.0005 —Å–µ–∫
2025-03-06 02:51:15,424 - INFO - ‚úÖ [FUNC](func_name: execute_query; func_uuid: 0a4fea) –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞ 0.0022 —Å–µ–∫
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ

Alchemica –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —Å SQLAlchemy –∏ asyncio.

### –ü—Ä–∏–º–µ—Ä –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
import asyncio

from alchemica import async_sql_logger
from sqlalchemy import Table, Column, Integer, String, MetaData
from sqlalchemy import insert
from sqlalchemy.ext.asyncio import create_async_engine, AsyncSession

# –°–æ–∑–¥–∞–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
async_engine = create_async_engine("sqlite+aiosqlite:///:memory:")

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ —Ç–∞–±–ª–∏—Ü—É
metadata = MetaData()
users_table = Table(
    "users",
    metadata,
    Column("id", Integer, primary_key=True),
    Column("name", String),
)


@async_sql_logger(compile_sql=True, explain_plan=True)
async def create_user(name: str):
    """
    –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    """
    async with AsyncSession(async_engine) as session:
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º SQLAlchemy Core –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
        stmt = insert(users_table).values(name=name)
        await session.execute(stmt)
        await session.commit()


# –û—Å–Ω–æ–≤–Ω–∞—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
@async_sql_logger(compile_sql=True)
async def main():
    # –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É users
    async with async_engine.begin() as conn:
        await conn.run_sync(metadata.create_all)

    # –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    await create_user("Alice")


# –ó–∞–ø—É—Å–∫–∞–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥
if __name__ == '__main__':
    asyncio.run(main())


```

–í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å:

```text
2025-03-06 03:11:34,493 - INFO - üöÄ [FUNC](func_name: main; func_uuid: 6c1054) –∑–∞–ø—É—â–µ–Ω–∞
2025-03-06 03:11:34,495 - INFO - üü¢ [SQL](func_name: main; func_uuid: 6c1054; query_uuid: 155ef2) 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	name VARCHAR, 
	PRIMARY KEY (id)
)


2025-03-06 03:11:34,495 - INFO - üïëÔ∏è [SQL](func_name: main; func_uuid: 6c1054; query_uuid: 155ef2) –í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞ 0.0003 —Å–µ–∫
2025-03-06 03:11:34,496 - INFO - üöÄ [FUNC](func_name: create_user; func_uuid: ddb888) –∑–∞–ø—É—â–µ–Ω–∞
2025-03-06 03:11:34,496 - INFO - üü¢ [SQL](func_name: create_user; func_uuid: ddb888; query_uuid: fb157e) INSERT INTO users (name) VALUES ('Alice')
2025-03-06 03:11:34,496 - INFO - üìù [SQL PLAN](func_name: create_user; func_uuid: ddb888; query_uuid: fb157e) 
0 Init 0 8 0 None 0 None
1 OpenWrite 0 2 0 2 0 None
2 SoftNull 2 0 0 None 0 None
3 String8 0 3 0 Alice 0 None
4 NewRowid 0 1 0 None 0 None
5 MakeRecord 2 2 4 DB 0 None
6 Insert 0 4 1 users 57 None
7 Halt 0 0 0 None 0 None
8 Transaction 0 1 1 0 1 None
9 Goto 0 1 0 None 0 None
2025-03-06 03:11:34,497 - INFO - üïëÔ∏è [SQL](func_name: create_user; func_uuid: ddb888; query_uuid: fb157e) –í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞ 0.0005 —Å–µ–∫
2025-03-06 03:11:34,497 - INFO - ‚úÖ [FUNC](func_name: create_user; func_uuid: ddb888) –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞ 0.0015 —Å–µ–∫
2025-03-06 03:11:34,497 - INFO - ‚úÖ [FUNC](func_name: main; func_uuid: 6c1054) –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞ 0.0039 —Å–µ–∫
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ Alchemica

–û–¥–Ω–æ–π –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π Alchemica —è–≤–ª—è–µ—Ç—Å—è –∏–∑–æ–ª—è—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä
sync_sql_logger –∏–ª–∏ async_sql_logger –ª–æ–≥–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ SQL-–∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∫ –∫–æ—Ç–æ—Ä–æ–π
–æ–Ω –ø—Ä–∏–º–µ–Ω–µ–Ω. –ï—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥—Ä—É–≥–∞—è —Ñ—É–Ω–∫—Ü–∏—è, —Ç–∞–∫–∂–µ –¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è sync_sql_logger –∏–ª–∏
async_sql_logger, —Ç–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –±—É–¥—É—Ç —Ç–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å—ã –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —ç—Ç–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –∞ –Ω–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π
—Ñ—É–Ω–∫—Ü–∏–∏.

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ö–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
    * –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ –¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é
      UUID.

    * –õ–æ–≥–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–µ SQL-–∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —ç—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ.

2. **–í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
    * –ï—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ –¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥—Ä—É–≥–∞—è —Ñ—É–Ω–∫—Ü–∏—è, —Ç–∞–∫–∂–µ –¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è `sync_sql_logger` –∏–ª–∏
      `async_sql_logger`, —Ç–æ –¥–ª—è –Ω–µ–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

    * –ó–∞–ø—Ä–æ—Å—ã –≤–Ω—É—Ç—Ä–∏ –≤–ª–æ–∂–µ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –µ–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ, –∞ –Ω–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.

### –ü—Ä–∏–º–µ—Ä

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–∏–º–µ—Ä, –≥–¥–µ –µ—Å—Ç—å –¥–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏: `outer_function` –∏ `inner_function`.
–û–±–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω—ã `sync_sql_logger`.

```python
from sqlalchemy import create_engine, text
from alchemica import sync_sql_logger

# –°–æ–∑–¥–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
engine = create_engine("sqlite:///:memory:")


@sync_sql_logger()
def outer_function():
    """
    –í–Ω–µ—à–Ω—è—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Ñ—É–Ω–∫—Ü–∏—é.
    """
    with engine.connect() as conn:
        conn.execute(text("SELECT 1"))  # –ó–∞–ø—Ä–æ—Å 1
        inner_function()  # –í—ã–∑–æ–≤ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Ñ—É–Ω–∫—Ü–∏–∏
        conn.execute(text("SELECT 2"))  # –ó–∞–ø—Ä–æ—Å 2


@sync_sql_logger()
def inner_function():
    """
    –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–≤–æ–π SQL-–∑–∞–ø—Ä–æ—Å.
    """
    with engine.connect() as conn:
        conn.execute(text("SELECT 3"))  # –ó–∞–ø—Ä–æ—Å 3


# –í—ã–∑–æ–≤ –≤–Ω–µ—à–Ω–µ–π —Ñ—É–Ω–∫—Ü–∏–∏
outer_function()
```

–í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å:

```text
2025-03-06 03:18:04,659 - INFO - üöÄ [FUNC](func_name: outer_function; func_uuid: 77afc9) –∑–∞–ø—É—â–µ–Ω–∞
2025-03-06 03:18:04,660 - INFO - üü¢ [SQL](func_name: outer_function; func_uuid: 77afc9; query_uuid: 07d89d) SELECT 1
2025-03-06 03:18:04,660 - INFO - üïëÔ∏è [SQL](func_name: outer_function; func_uuid: 77afc9; query_uuid: 07d89d) –í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞ 0.0002 —Å–µ–∫
2025-03-06 03:18:04,660 - INFO - üöÄ [FUNC](func_name: inner_function; func_uuid: ef9eed) –∑–∞–ø—É—â–µ–Ω–∞
2025-03-06 03:18:04,660 - INFO - üü¢ [SQL](func_name: inner_function; func_uuid: ef9eed; query_uuid: 86e750) SELECT 3
2025-03-06 03:18:04,660 - INFO - üïëÔ∏è [SQL](func_name: inner_function; func_uuid: ef9eed; query_uuid: 86e750) –í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞ 0.0001 —Å–µ–∫
2025-03-06 03:18:04,660 - INFO - ‚úÖ [FUNC](func_name: inner_function; func_uuid: ef9eed) –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞ 0.0002 —Å–µ–∫
2025-03-06 03:18:04,660 - INFO - üü¢ [SQL](func_name: outer_function; func_uuid: 77afc9; query_uuid: db39e7) SELECT 2
2025-03-06 03:18:04,660 - INFO - üïëÔ∏è [SQL](func_name: outer_function; func_uuid: 77afc9; query_uuid: db39e7) –í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞ 0.0001 —Å–µ–∫
2025-03-06 03:18:04,660 - INFO - ‚úÖ [FUNC](func_name: outer_function; func_uuid: 77afc9) –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞ 0.0014 —Å–µ–∫
```

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–ò–∑–æ–ª—è—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:**

    * –ö–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è (outer_function –∏ inner_function) –∏–º–µ–µ—Ç —Å–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π
      –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é func_uuid.

    * –õ–æ–≥–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–µ SQL-–∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ç–µ–∫—É—â–µ–π —Ñ—É–Ω–∫—Ü–∏–∏.

2. **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã:**

    * –ö–∞–∂–¥—ã–π SQL-–∑–∞–ø—Ä–æ—Å –∏–º–µ–µ—Ç —Å–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (query_uuid), —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö
      –∑–∞–ø—Ä–æ—Å–æ–≤.

3. **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**

    * –î–ª—è –∫–∞–∂–¥–æ–≥–æ SQL-–∑–∞–ø—Ä–æ—Å–∞ –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —á—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

4. **–ò–µ—Ä–∞—Ä—Ö–∏—è –≤—ã–∑–æ–≤–æ–≤:**

    * –õ–æ–≥–∏ —á–µ—Ç–∫–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, –∫–∞–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç –¥—Ä—É–≥—É—é, –∏ –∫–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –∫–∞–∂–¥–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ.

> –í–∞–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –µ—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä —Ç–æ–ª—å–∫–æ –Ω–∞ `outer_function`, —Ç–æ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –ª–æ–≥ –≤
> –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏. –ê –µ—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä —Ç–æ–ª—å–∫–æ –Ω–∞ `inner_function`, —Ç–æ –∑–∞–ø—Ä–æ—Å—ã –∏–∑ `outer_function` –Ω–µ
> –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –ª–æ–≥.

### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

–î–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –≤ –≤–∏–¥–µ –¥–µ—Ä–µ–≤–∞:

```text
outer_function (func_uuid: 77afc9)
‚îú‚îÄ‚îÄ SQL: SELECT 1 (query_uuid: 07d89d)
‚îú‚îÄ‚îÄ inner_function (func_uuid: ef9eed)
‚îÇ   ‚îî‚îÄ‚îÄ SQL: SELECT 3 (query_uuid: 86e750)
‚îî‚îÄ‚îÄ SQL: SELECT 2 (query_uuid: db39e7)
```

## –õ–æ–≥–∏—Ä—É–µ–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

Alchemica –ª–æ–≥–∏—Ä—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Å–æ–±—ã—Ç–∏—è:

–ó–∞–ø—É—Å–∫ —Ñ—É–Ω–∫—Ü–∏–∏:

```text
üöÄ [FUNC](func_name: execute_query; func_uuid: abc123) –∑–∞–ø—É—â–µ–Ω–∞
```

–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–∞:

```text
üü¢ [SQL](func_name: execute_query; func_uuid: abc123; query_uuid: def456) SELECT * FROM users WHERE id = :id
```

–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:

```text
‚úÖ [FUNC](func_name: execute_query; func_uuid: abc123) –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞ 0.1234 —Å–µ–∫
```

–ú–µ–¥–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å:

```text
‚ö†Ô∏è [SQL](func_name: execute_query; func_uuid: abc123) –ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω—è–ª—Å—è –¥–æ–ª—å—à–µ 1 —Å–µ–∫—É–Ω–¥: 1.2345 —Å–µ–∫
```

–ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (EXPLAIN):

```text
üìù [SQL PLAN](func_name: execute_query; func_uuid: abc123)
SCAN TABLE users
```

–û—à–∏–±–∫–∏:

```text
‚ùå [SQL ERROR](func_name: execute_query; func_uuid: abc123) –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞: ...
```

---

Alchemica ‚Äî –≤–∞—à –Ω–∞–¥–µ–∂–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤! üöÄ
